{% extends 'base.html' %}

{% block title %}Search Results{% endblock %}

{% block content %}
{% if photos %}
  {% if trip %}
    <h3>  {{ trip.city_name }} Photos</h3>
  {% else %}
    <h3>Search Results</h3>
  {% endif %}
    <section id="blocks">
    {% for photo in photos %}
    <div class="results">
      {% if session.get('login') and trip %}
        <img src="{{ photo.url }}" data-src="{{ photo.url }}" id="{{ photo.img_id }}" class="img-responsive">

        <form class="add-trip-form"
        data-img_id="{{photo.img_id}}"
        data-url="{{photo.url}}" 
        data-lat="{{photo.lat}}"
        data-lon="{{photo.lon}}"
        data-city_name="{{photo.city_name}}"
        data-trip="{{ trip.trip_id }}"
        id="form-{{photo.img_id}}" 
        action="/add-photo"
        method="POST">
        <input type="submit" class="btn btn-link" value="Add to Trip">
      </form>

      {% else %}
      <img src="{{ photo.url }}" data-src="{{ photo.url }}" id="{{ photo.img_id }}" class="img-responsive">
      {% endif %}
    </div>
    {% endfor %}
    </section>
{% else %}
<h3> Sorry no results. Please try another search.</h3>
{% endif %}

<script>

"use strict";

function handleAddSubmit() {
  $('form.add-trip-form').on('submit', (evt) => {
    evt.preventDefault();
    alert('Photo added')

    const formInputs = {
      'img_id': $(evt.target).data( "img_id" ),
      'url': $(evt.target).data( "url" ),
      'lat': $(evt.target).data( "lat" ),
      'lon': $(evt.target).data( "lon" ),
      'city_name': $(evt.target).data( "city_name" ),
      'trip': $(evt.target).data( "trip" )
    };
    console.log(formInputs)

    $.post('/add-photo', formInputs, (results) => {
      $(evt.target).submit.style.display="none";
    });
  });
}

handleAddSubmit();

</script>

{% endblock %}

